<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>Sitecore Docker: Making Those Urls Pretty | Sitecore Nuts &amp; Bolts</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Containers, Containers, Containers! Getting Sitecore running on containers using Docker seems to be the current craze/buzzword. It’s really gaining traction, but unlike a lot of fads, frameworks and b">
<meta name="keywords" content="Sitecore,Docker">
<meta property="og:type" content="article">
<meta property="og:title" content="Sitecore Docker: Making Those Urls Pretty">
<meta property="og:url" content="http://www.sitecorenutsbolts.net/2020/02/19/Sitecore-Docker-Making-Those-Urls-Pretty/index.html">
<meta property="og:site_name" content="Sitecore Nuts &amp; Bolts">
<meta property="og:description" content="Containers, Containers, Containers! Getting Sitecore running on containers using Docker seems to be the current craze/buzzword. It’s really gaining traction, but unlike a lot of fads, frameworks and b">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://www.sitecorenutsbolts.net/2020/02/19/Sitecore-Docker-Making-Those-Urls-Pretty/containerseverywhere.jpg">
<meta property="og:image" content="http://www.sitecorenutsbolts.net/2020/02/19/Sitecore-Docker-Making-Those-Urls-Pretty/serverproxysettings.png">
<meta property="og:image" content="http://www.sitecorenutsbolts.net/2020/02/19/Sitecore-Docker-Making-Those-Urls-Pretty/enablerp.png">
<meta property="og:updated_time" content="2020-05-12T14:52:21.792Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Sitecore Docker: Making Those Urls Pretty">
<meta name="twitter:description" content="Containers, Containers, Containers! Getting Sitecore running on containers using Docker seems to be the current craze/buzzword. It’s really gaining traction, but unlike a lot of fads, frameworks and b">
<meta name="twitter:image" content="http://www.sitecorenutsbolts.net/2020/02/19/Sitecore-Docker-Making-Those-Urls-Pretty/containerseverywhere.jpg">
  
  

  <link rel="stylesheet" href="/css/style.css">
  
  
  


  

<!--
  
    <link href='//fonts.useso.com/css?family=Titillium+Web:300,400,600' rel='stylesheet' type='text/css'>
    <link href="//fonts.useso.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
-->
</head>
</html>
<body>
  <div id="wrap">
    <header id="header">
  <div id="header-outer" class="outer">
    <div class="container">
      <div class="container-inner">
        <div id="header-title">
          <h1 class="logo-wrap">
            <a href="/" class="logo"></a>
          </h1>
          
            <h2 class="subtitle-wrap">
              <p class="subtitle">Design it, Code it, Build it. C# &amp; Sitecore!</p>
            </h2>
          
          
          <div class="mvp">
            <a href="http://www.sitecore.net/mvp" target="_blank">
              <img src="/about/index/MVP2016.jpg" alt="Sitecore MVP 2016-2020">
            </a>
            <a href="http://www.sitecore.net/mvp" target="_blank">
              <img src="/about/index/Technology2020.jpg" alt="Sitecore MVP 2016-2020">
            </a>
            <a href="http://www.sitecore.net/mvp" target="_blank">
              <img src="/about/index/Technology2019.jpg" alt="Sitecore MVP 2016-2020">
            </a>
            <a href="http://www.sitecore.net/mvp" target="_blank">
              <img src="/about/index/Technology2018.jpg" alt="Sitecore MVP 2016-2020">
            </a>
            <a href="http://www.sitecore.net/mvp" target="_blank">
                <img src="/about/index/Technology2017.jpg" alt="Sitecore MVP 2016-2020">
            </a>
            <a href="http://www.sitecore.net/mvp" target="_blank">
                <img src="/about/index/Technology2016.jpg" alt="Sitecore MVP 2016-2020">
            </a>
          </div>
          
        </div>
        <div id="header-inner" class="nav-container">
          <a id="main-nav-toggle" class="nav-icon"></a>
          <div class="nav-container-inner">
            <ul id="main-nav">
              
            </ul>
            <nav id="sub-nav">
              <div id="search-form-wrap">
                <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><input type="hidden" name="sitesearch" value="http://www.sitecorenutsbolts.net"></form>
              </div>
            </nav>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>
    <div class="container">
      <div class="main-body container-inner">
        <div class="main-body-inner">
          <section id="main">
            <div class="main-body-header">

              <h1 class="header"><a class="page-title-link" href="/categories/Docker/">Docker</a></h1>
            </div>
            <div class="main-body-content">
              
  <article id="post-Sitecore-Docker-Making-Those-Urls-Pretty" class="article article-single article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
      <!--  -->
      
        <header class="article-header">
          
  
    <h1 class="article-title" itemprop="name">
      Sitecore Docker: Making Those Urls Pretty
    </h1>
  

        </header>
      
      <p class="article-byline">
        <a href="/2020/02/19/Sitecore-Docker-Making-Those-Urls-Pretty/" class="article-date">
  <time datetime="2020-02-19T14:13:24.000Z" itemprop="datePublished">2020-02-19</time>
</a>
      </p>
      <div class="article-entry" itemprop="articleBody">
        <code>Estimated reading time:<span class="eta"></span></code>
        <h3 id="Containers-Containers-Containers"><a href="#Containers-Containers-Containers" class="headerlink" title="Containers, Containers, Containers!"></a>Containers, Containers, Containers!</h3><img src="/2020/02/19/Sitecore-Docker-Making-Those-Urls-Pretty/containerseverywhere.jpg">
<p>Getting Sitecore running on containers using Docker seems to be the current craze/buzzword. It’s really gaining traction, but unlike a lot of fads, frameworks and buzzwords, this one actually is useful!</p>
<p>This blog post is not going to give you any tutorials or how-to’s on setting up Sitecore on Docker. Some people far cleverer than I have already done that. If you want a simple no frills intro, you can’t get much better than <a href="https://intothecloud.blog/" target="_blank" rel="noopener">Mark Cassidy’s</a> series:</p>
<ul>
<li><a href="https://intothecloud.blog/2019/09/14/Sitecore-Docker-for-Dummies/" target="_blank" rel="noopener">Docker for Dummies - Docker 101  or Docker Basics</a></li>
<li><a href="https://intothecloud.blog/2019/09/16/Setting-up-Sitecore-Docker-Images/" target="_blank" rel="noopener">Docker for Dummies - Setting up Sitecore Docker images</a></li>
<li><a href="https://intothecloud.blog/2019/09/21/Deploying-and-Debugging-Your-Visual-Studio-Solution-to-Your-Sitecore-Docker-Containers/" target="_blank" rel="noopener">Docker for Dummies - Deploying &amp; Debugging Visual Studio Solutions</a></li>
</ul>
<h3 id="So-What’s-with-the-Urls-Then"><a href="#So-What’s-with-the-Urls-Then" class="headerlink" title="So What’s with the Urls Then?"></a>So What’s with the Urls Then?</h3><p>Getting Sitecore running on Docker, turns out to be pretty simple. Follow the steps in the articles above and soon you’ll be loading up <code>http://localhost:44001</code> or <code>http://localhost:44002</code> in your browser. From this point, I’ll assume you have managed to get Sitecore running in Docker on your local machine.</p>
<p>But here is where my problems started. First, if you are developing a multisite solution, <code>localhost</code> isn’t going to cut it for long. As soon as you need a second site, you need domain names. Also, if you are working on multple client projects, <code>localhost</code> can get hard to keep track. Sure, you might only be running containers for one client at a time, but in the CM, it would be nice to have a quick glance at the url to remind yourself which project/client you are on. You might run multiple containers at once. Finally, I just don’t like having to put the port number in the url. Yes, its just asthetics, and yes it does make me one of “those” people! But it is what it is, the port number is ugly - I like having pretty urls!</p>
<p>One more thing that I like to have for local development, is my sites running under SSL. That might seem overkill, and I agree 90% of the time it is. But I’ve seen too many bugs make it into the codebase because everything was tested on HTTP locally and then broke as soon as the protocol changed. Both via the <code>LinkManager</code> screwing things up, and by lazy developers doing silly things like hard coding the protocol! (insert your fav Picard face palm gif here!), and yes I agree that these are things that <em>shouldn’t</em> happen, we have all seen stupid issues like that. So I like to be in a position to test those kind of things before pushing the code out to QA.</p>
<h3 id="THIDI-Fixing-the-Url’s"><a href="#THIDI-Fixing-the-Url’s" class="headerlink" title="THIDI: Fixing the Url’s"></a>THIDI: Fixing the Url’s</h3><p>There are a few different approaches to “fixing” the urls for Docker to look pretty. <a href>Michael West</a> has a <a href="https://github.com/michaellwest/docker-https" target="_blank" rel="noopener">Docker Repo</a> that solves this using a <code>startup.ps1</code> PowerShell script that will modify the hosts file in the container, using a nifty little script by <a href="https://github.com/RAhnemann/windows-hosts-writer" target="_blank" rel="noopener">Rob Ahnemann</a>.</p>
<p>My approach was slightly different. I ended up using IIS as a reverse proxy to the Docker containers. I had played around with other reverse proxies like <a href="https://containo.us/traefik/" target="_blank" rel="noopener">Traefik</a>. But to have those monitoring port 80, it meant that IIS had to be turned off. As not all of our projects are containerized yet, this is not an option.</p>
<p>But getting IIS to act as a reverse proxy is pretty simple.</p>
<h4 id="Prerequisites"><a href="#Prerequisites" class="headerlink" title="Prerequisites"></a>Prerequisites</h4><p>First, we need to make sure that we have the following modules installed. These can be installed by the Web Platform Installer:</p>
<ul>
<li>Url Rewrite v2.1 or higher</li>
<li>Application Request Routing v3 or higher</li>
</ul>
<p>Once installed, you get a new icon in IIS when you click on the server. <strong>Application Request Routing Cache</strong>. First thing to do is fire up IIS, open up the <code>Application Requet Routing Cache</code> and then click <code>Server Proxy Settings</code>:</p>
<img src="/2020/02/19/Sitecore-Docker-Making-Those-Urls-Pretty/serverproxysettings.png">
<p>Now tick the checkbox to enable reverse proxies:</p>
<img src="/2020/02/19/Sitecore-Docker-Making-Those-Urls-Pretty/enablerp.png">
<h4 id="Docker-Compose-Modifications"><a href="#Docker-Compose-Modifications" class="headerlink" title="Docker Compose Modifications"></a>Docker Compose Modifications</h4><p>Now we have the basic setup in IIS. Its time to setup the <code>docker-compose.yml</code> file. I’ll just show the relavent parts here:</p>
<p>At the bottom of the file, make sure you have your networks configured:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">networks:</span></span><br><span class="line"><span class="attr">  default:</span></span><br><span class="line"><span class="attr">    external:</span></span><br><span class="line"><span class="attr">      name:</span> <span class="string">nat</span></span><br></pre></td></tr></table></figure>
<p>Now for the CD and CM, you can add aliases:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cm:</span></span><br><span class="line"><span class="attr">  image:</span> <span class="string">$&#123;REGISTRY&#125;sitecore-xp-sxa-standalone:$&#123;SITECORE_VERSION&#125;-windowsservercore-$&#123;WINDOWSSERVERCORE_VERSION&#125;</span></span><br><span class="line"><span class="attr">  entrypoint:</span> <span class="string">powershell.exe</span> <span class="bullet">-Command</span> <span class="string">"&amp; C:\\tools\\entrypoints\\iis\\Development.ps1"</span></span><br><span class="line"><span class="attr">  volumes:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">.\startup:C:\startup</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">..\build\Debug:C:\src</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">..\src:C:\inetpub\wwwroot\app_data\unicorn</span></span><br><span class="line"><span class="attr">  ports:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">"44001:80"</span></span><br><span class="line"><span class="attr">  networks:</span></span><br><span class="line"><span class="attr">    default:</span></span><br><span class="line"><span class="attr">      aliases:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">myproject-cm.dev.local</span></span><br><span class="line"><span class="attr">  environment:</span></span><br><span class="line"><span class="attr">    HOST_HEADER:</span> <span class="string">myproject-cm.dev.local</span></span><br><span class="line"><span class="attr">    SITECORE_LICENSE:</span> <span class="string">$&#123;SITECORE_LICENSE&#125;</span></span><br><span class="line"><span class="attr">    SITECORE_APPSETTINGS_ROLE:</span><span class="attr">DEFINE:</span> <span class="string">Standalone</span></span><br><span class="line"><span class="attr">    SITECORE_APPSETTINGS_SXAXM:</span><span class="attr">DEFINE:</span> <span class="string">sxaxconnect</span></span><br><span class="line"><span class="attr">    SITECORE_CONNECTIONSTRINGS_CORE:</span> <span class="string">Data</span> <span class="string">Source=sql;Initial</span> <span class="string">Catalog=Sitecore.Core;User</span> <span class="string">ID=sa;Password=$&#123;SQL_SA_PASSWORD&#125;</span></span><br><span class="line"><span class="attr">    SITECORE_CONNECTIONSTRINGS_SECURITY:</span> <span class="string">Data</span> <span class="string">Source=sql;Initial</span> <span class="string">Catalog=Sitecore.Core;User</span> <span class="string">ID=sa;Password=$&#123;SQL_SA_PASSWORD&#125;</span></span><br><span class="line"><span class="attr">    SITECORE_CONNECTIONSTRINGS_MASTER:</span> <span class="string">Data</span> <span class="string">Source=sql;Initial</span> <span class="string">Catalog=Sitecore.Master;User</span> <span class="string">ID=sa;Password=$&#123;SQL_SA_PASSWORD&#125;</span></span><br><span class="line"><span class="attr">    SITECORE_CONNECTIONSTRINGS_WEB:</span> <span class="string">Data</span> <span class="string">Source=sql;Initial</span> <span class="string">Catalog=Sitecore.Web;User</span> <span class="string">ID=sa;Password=$&#123;SQL_SA_PASSWORD&#125;</span></span><br><span class="line"><span class="attr">    SITECORE_CONNECTIONSTRINGS_EXPERIENCEFORMS:</span> <span class="string">Data</span> <span class="string">Source=sql;Initial</span> <span class="string">Catalog=Sitecore.ExperienceForms;User</span> <span class="string">ID=sa;Password=$&#123;SQL_SA_PASSWORD&#125;</span></span><br><span class="line">    <span class="string">SITECORE_CONNECTIONSTRINGS_SOLR.SEARCH:</span> <span class="attr">http://solr:8983/solr</span></span><br><span class="line"><span class="attr">    SITECORE_CONNECTIONSTRINGS_MESSAGING:</span> <span class="string">Data</span> <span class="string">Source=sql;Database=Sitecore.Messaging;User</span> <span class="string">ID=sa;Password=$&#123;SQL_SA_PASSWORD&#125;</span></span><br><span class="line">    <span class="string">SITECORE_CONNECTIONSTRINGS_XDB.MARKETINGAUTOMATION:</span> <span class="string">Data</span> <span class="string">Source=sql;Database=Sitecore.MarketingAutomation;User</span> <span class="string">ID=sa;Password=$&#123;SQL_SA_PASSWORD&#125;</span></span><br><span class="line">    <span class="string">SITECORE_CONNECTIONSTRINGS_XDB.PROCESSING.POOLS:</span> <span class="string">Data</span> <span class="string">Source=sql;Database=Sitecore.Processing.Pools;User</span> <span class="string">ID=sa;Password=$&#123;SQL_SA_PASSWORD&#125;</span></span><br><span class="line">    <span class="string">SITECORE_CONNECTIONSTRINGS_XDB.REFERENCEDATA:</span> <span class="string">Data</span> <span class="string">Source=sql;Database=Sitecore.ReferenceData;User</span> <span class="string">ID=sa;Password=$&#123;SQL_SA_PASSWORD&#125;</span></span><br><span class="line">    <span class="string">SITECORE_CONNECTIONSTRINGS_XDB.PROCESSING.TASKS:</span> <span class="string">Data</span> <span class="string">Source=sql;Database=Sitecore.Processing.Tasks;User</span> <span class="string">ID=sa;Password=$&#123;SQL_SA_PASSWORD&#125;</span></span><br><span class="line">    <span class="string">SITECORE_CONNECTIONSTRINGS_EXM.MASTER:</span> <span class="string">Data</span> <span class="string">Source=sql;Database=Sitecore.EXM.Master;User</span> <span class="string">ID=sa;Password=$&#123;SQL_SA_PASSWORD&#125;</span></span><br><span class="line"><span class="attr">    SITECORE_CONNECTIONSTRINGS_REPORTING:</span> <span class="string">Data</span> <span class="string">Source=sql;Database=Sitecore.Reporting;User</span> <span class="string">ID=sa;Password=$&#123;SQL_SA_PASSWORD&#125;</span></span><br><span class="line">    <span class="string">SITECORE_CONNECTIONSTRINGS_SITECORE.REPORTING.CLIENT:</span> <span class="attr">http://xconnect</span></span><br><span class="line">    <span class="string">SITECORE_CONNECTIONSTRINGS_XCONNECT.COLLECTION:</span> <span class="attr">http://xconnect</span></span><br><span class="line">    <span class="string">SITECORE_CONNECTIONSTRINGS_XDB.MARKETINGAUTOMATION.OPERATIONS.CLIENT:</span> <span class="attr">http://xconnect</span></span><br><span class="line">    <span class="string">SITECORE_CONNECTIONSTRINGS_XDB.MARKETINGAUTOMATION.REPORTING.CLIENT:</span> <span class="attr">http://xconnect</span></span><br><span class="line">    <span class="string">SITECORE_CONNECTIONSTRINGS_XDB.REFERENCEDATA.CLIENT:</span> <span class="attr">http://xconnect</span></span><br><span class="line">    <span class="string">SITECORE_APPSETTINGS_TELERIK.ASYNCUPLOAD.CONFIGURATIONENCRYPTIONKEY:</span> <span class="string">$&#123;TELERIK_ENCRYPTION_KEY&#125;</span></span><br><span class="line">    <span class="string">SITECORE_APPSETTINGS_TELERIK.UPLOAD.CONFIGURATIONHASHKEY:</span> <span class="string">$&#123;TELERIK_ENCRYPTION_KEY&#125;</span></span><br><span class="line">    <span class="string">SITECORE_APPSETTINGS_TELERIK.WEB.UI.DIALOGPARAMETERSENCRYPTIONKEY:</span> <span class="string">$&#123;TELERIK_ENCRYPTION_KEY&#125;</span></span><br><span class="line"><span class="attr">  depends_on:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">sql</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">solr</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">xconnect</span></span><br></pre></td></tr></table></figure>
<h4 id="Configure-the-Reverse-Proxy"><a href="#Configure-the-Reverse-Proxy" class="headerlink" title="Configure the Reverse Proxy"></a>Configure the Reverse Proxy</h4><p>To setup the Reverse Proxy website. My repo has a folder in just called <code>proxy</code> with the following <code>web.config</code> file:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">system.webServer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rewrite</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">outboundRules</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">"ReverseProxyOutboundRule_CM"</span> <span class="attr">preCondition</span>=<span class="string">"ResponseIsHtml1"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">match</span> <span class="attr">filterByTags</span>=<span class="string">"A, Form, Img"</span> <span class="attr">pattern</span>=<span class="string">"^http(s)?://localhost:44001/(.*)"</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">action</span> <span class="attr">type</span>=<span class="string">"Rewrite"</span> <span class="attr">value</span>=<span class="string">"http&#123;R:1&#125;://myproject-cm.dev.local/&#123;R:2&#125;"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">"ReverseProxyOutboundRule_CD"</span> <span class="attr">preCondition</span>=<span class="string">"ResponseIsHtml1"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">match</span> <span class="attr">filterByTags</span>=<span class="string">"A, Form, Img"</span> <span class="attr">pattern</span>=<span class="string">"^http(s)?://localhost:44002/(.*)"</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">action</span> <span class="attr">type</span>=<span class="string">"Rewrite"</span> <span class="attr">value</span>=<span class="string">"http&#123;R:1&#125;://&#123;ORIGINAL_HOST&#125;/&#123;R:2&#125;"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">preConditions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">preCondition</span> <span class="attr">name</span>=<span class="string">"ResponseIsHtml1"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">add</span> <span class="attr">input</span>=<span class="string">"&#123;RESPONSE_CONTENT_TYPE&#125;"</span> <span class="attr">pattern</span>=<span class="string">"^text/html"</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">preCondition</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">preConditions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">outboundRules</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rules</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">"ReverseProxyInboundRule_CM"</span> <span class="attr">stopProcessing</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">match</span> <span class="attr">url</span>=<span class="string">"(.*)"</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">conditions</span> <span class="attr">logicalGrouping</span>=<span class="string">"MatchAll"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">add</span> <span class="attr">input</span>=<span class="string">"&#123;HTTP_HOST&#125;"</span> <span class="attr">pattern</span>=<span class="string">"^(myproject-cm\.dev\.local)$"</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">add</span> <span class="attr">input</span>=<span class="string">"&#123;REQUEST_FILENAME&#125;"</span> <span class="attr">matchType</span>=<span class="string">"IsFile"</span> <span class="attr">negate</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">conditions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">action</span> <span class="attr">type</span>=<span class="string">"Rewrite"</span> <span class="attr">url</span>=<span class="string">"http://localhost:44001/&#123;R:1&#125;"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">"ReverseProxyInboundRule_CD"</span> <span class="attr">stopProcessing</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">match</span> <span class="attr">url</span>=<span class="string">"(.*)"</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">conditions</span> <span class="attr">logicalGrouping</span>=<span class="string">"MatchAll"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">add</span> <span class="attr">input</span>=<span class="string">"&#123;HTTP_HOST&#125;"</span> <span class="attr">pattern</span>=<span class="string">"^((site1|site2|site3)\.dev\.local)$"</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">add</span> <span class="attr">input</span>=<span class="string">"&#123;REQUEST_FILENAME&#125;"</span> <span class="attr">matchType</span>=<span class="string">"IsFile"</span> <span class="attr">negate</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">conditions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">action</span> <span class="attr">type</span>=<span class="string">"Rewrite"</span> <span class="attr">url</span>=<span class="string">"http://&#123;HTTP_HOST&#125;:44002/&#123;R:1&#125;"</span> <span class="attr">logRewrittenUrl</span>=<span class="string">"false"</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">serverVariables</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"ORIGINAL_HOST"</span> <span class="attr">value</span>=<span class="string">"&#123;HTTP_HOST&#125;"</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">serverVariables</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rules</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rewrite</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">urlCompression</span> <span class="attr">doStaticCompression</span>=<span class="string">"false"</span> <span class="attr">doDynamicCompression</span>=<span class="string">"false"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">system.webServer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>To create the IIS Website, a developer simply needs to run a couple of PowerShell scripts:</p>
<p>First, <code>Create-WildcardCert.ps1</code>, this just creates a <code>*.dev.local</code> cert for local development. There are various versions of this script floating about. I can’t remember exactly the origins of this one, if its yours DM me on Slack and I’ll add a credit here!</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Param</span>(</span><br><span class="line">    <span class="variable">$WildCardDomain</span> = <span class="string">"*.dev.local"</span>,</span><br><span class="line">    <span class="variable">$RootDomain</span> = <span class="string">"dev.local"</span>,</span><br><span class="line">    <span class="variable">$WildCardCertName</span> = <span class="string">"DO NOT TRUST Sitecore Local Development dev.local"</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">process</span> &#123;</span><br><span class="line">    <span class="comment"># Generate SSL cert</span></span><br><span class="line">    <span class="variable">$existingCert</span> = <span class="built_in">Get-ChildItem</span> Cert:\LocalMachine\Root | Where FriendlyName <span class="nomarkup">-eq</span> <span class="variable">$WildCardCertName</span></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$existingCert</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">"Creating &amp; trusting an new SSL Cert for <span class="variable">$WildCardCertName</span>"</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment"># Generate a cert</span></span><br><span class="line">        <span class="comment"># https://docs.microsoft.com/en-us/powershell/module/pkiclient/new-selfsignedcertificate?view=win10-ps</span></span><br><span class="line">        <span class="variable">$cert</span> = New-SelfSignedCertificate -FriendlyName <span class="variable">$WildCardCertName</span> -Subject <span class="variable">$RootDomain</span> -DnsName <span class="variable">$RootDomain</span>,<span class="variable">$WildCardDomain</span> -CertStoreLocation <span class="string">"cert:\LocalMachine\My"</span> -Type SSLServerAuthentication -NotAfter (<span class="built_in">Get-Date</span>).AddYears(<span class="number">10</span>)</span><br><span class="line">        Export-Certificate -Cert <span class="variable">$cert</span> -FilePath <span class="string">"<span class="variable">$PSScriptRoot</span>\<span class="variable">$RootDomain</span>.cer"</span></span><br><span class="line">        Import-Certificate -Filepath <span class="string">"<span class="variable">$PSScriptRoot</span>\<span class="variable">$RootDomain</span>.cer"</span> -CertStoreLocation <span class="string">"cert:\LocalMachine\Root"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Then we have <code>Create-ReverseProxy.ps1</code>. Pretty self explanitory, this script creates the AppPool and Web application in IIS:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="built_in">Import-Module</span> WebAdministration</span><br><span class="line"></span><br><span class="line">    <span class="variable">$iisAppPoolName</span> = <span class="string">"myproject-reverse-proxy-app"</span></span><br><span class="line">    <span class="variable">$iisAppPoolDotNetVersion</span> = <span class="string">"v4.0"</span></span><br><span class="line">    <span class="variable">$iisAppName</span> = <span class="string">"myproject-reverse-proxy"</span></span><br><span class="line">    <span class="variable">$directoryPath</span> = <span class="built_in">Get-Item</span> <span class="variable">$PSScriptRoot</span>\..\proxy | % &#123; <span class="variable">$_</span>.FullName &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#navigate to the app pools root</span></span><br><span class="line">    <span class="built_in">Set-Location</span> -Path IIS:\AppPools\</span><br><span class="line"></span><br><span class="line">    <span class="comment">#check if the app pool exists</span></span><br><span class="line">    <span class="keyword">if</span> (!(<span class="built_in">Test-Path</span> <span class="variable">$iisAppPoolName</span> -pathType container))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">"Creating the application pool"</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#create the app pool</span></span><br><span class="line">        <span class="variable">$appPool</span> = <span class="built_in">New-Item</span> <span class="variable">$iisAppPoolName</span></span><br><span class="line">        <span class="variable">$appPool</span> | <span class="built_in">Set-ItemProperty</span> -Name <span class="string">"managedRuntimeVersion"</span> -Value <span class="variable">$iisAppPoolDotNetVersion</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">"Trying to create the Site"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#navigate to the sites root</span></span><br><span class="line">    <span class="built_in">Set-Location</span> -Path IIS:\Sites\</span><br><span class="line"></span><br><span class="line">    <span class="comment">#check if the site exists</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Test-Path</span> <span class="variable">$iisAppName</span> -pathType container)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">"Site already exists"</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#create the site</span></span><br><span class="line">    <span class="variable">$iisApp</span> = <span class="built_in">New-Item</span> <span class="variable">$iisAppName</span> -bindings @&#123;protocol=<span class="string">"http"</span>;bindingInformation=<span class="string">":80:"</span> + <span class="variable">$iisAppName</span>&#125; -physicalPath <span class="variable">$directoryPath</span></span><br><span class="line">    <span class="variable">$iisApp</span> | <span class="built_in">Set-ItemProperty</span> -Name <span class="string">"applicationPool"</span> -Value <span class="variable">$iisAppPoolName</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">"Adding Bindings"</span></span><br><span class="line"></span><br><span class="line">    New-WebBinding -Name <span class="variable">$iisAppName</span> -IPAddress <span class="string">"*"</span> -Port <span class="number">443</span> -Protocol https -HostHeader <span class="string">"site1.dev.local"</span></span><br><span class="line">    New-WebBinding -Name <span class="variable">$iisAppName</span> -IPAddress <span class="string">"*"</span> -Port <span class="number">443</span> -Protocol https -HostHeader <span class="string">"site2.dev.local"</span></span><br><span class="line">    New-WebBinding -Name <span class="variable">$iisAppName</span> -IPAddress <span class="string">"*"</span> -Port <span class="number">443</span> -Protocol https -HostHeader <span class="string">"site3.dev.local"</span></span><br><span class="line">    New-WebBinding -Name <span class="variable">$iisAppName</span> -IPAddress <span class="string">"*"</span> -Port <span class="number">443</span> -Protocol https -HostHeader <span class="string">"myproject-cm.dev.local"</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">finally</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">"Done"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>I’m not a PowerShell wizard, so I’m sure this script could be made better. Most of the time, adding those bindings will select the correct <code>*.dev.local</code> certificate. But it doesn’t everytime and my PowerShell skills haven’t been able to figure out why yet. I’m sure someone will have a better way of doing that.</p>
<h3 id="Running-the-Sites"><a href="#Running-the-Sites" class="headerlink" title="Running the Sites"></a>Running the Sites</h3><p>Now that the reverse proxy is setup, all that remains is to run <code>docker-compose up</code>, wait for the conainers to start up and then hit one of those urls in your browser. You should see that Sitecore is responding nicely to the custom host names. There is no need to add a port number to the host and the Site Resolving should also work nicely.</p>
<p>As I mentioned above, there are a few ways of doing this. This is just one way that I have found that works well for our development team. I think Sitecore on Docker is a fantastic thing, it allows us to onboard new developers in minutes vs hours, and with just a few simple PowerShell scripts instead of complex and time consuming Sitecore installs. </p>
<p>Thanks to everyone that wrote blog posts on Docker and who helps out a lot on the <a href="https://sitecore.chat" target="_blank" rel="noopener">Sitecore Slack</a> channel for <code>#docker</code>, big thanks to Michael West and Mark Cassidy for blogs, git repos and answering stupid questions when I had them :)</p>
<p>Do you have another way, a better way to do this? Let me know in the comments or hit me up on Sitecore Slack - I’m <code>@guitarrich</code></p>
<p>Thanks</p>
<p>– Richard.</p>

      </div>
      <footer class="article-footer">
        <a data-url="http://www.sitecorenutsbolts.net/2020/02/19/Sitecore-Docker-Making-Those-Urls-Pretty/" data-id="cka5tzg9v004egsvrh3912osj" class="article-share-link">Share</a>
        
          <a href="http://www.sitecorenutsbolts.net/2020/02/19/Sitecore-Docker-Making-Those-Urls-Pretty/#comments" class="article-comment-link">Comments</a>
        
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Docker/">Docker</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Sitecore/">Sitecore</a></li></ul>

      </footer>
    </div>
  </article>
  
    <section id="comments">
      <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      </div>
    </section>
  


<!-- Go to www.addthis.com/dashboard to customize your tools -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-55d6161f325b85fa" async="async"></script>
            </div>
          </section>
          <aside id="sidebar">
  <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
  <div class="sidebar-top">
    <p>follow:</p>
    <ul class="social-links">
      
    </ul>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/05/13/Rendering-Links-with-Scriban/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">newer</strong>
      <p class="article-nav-title">
        
          Rendering Links with Scriban
        
      </p>
      <i class="icon" id="icon-chevron-right"></i>
    </a>
  
  
    <a href="/2019/08/09/Custom-Fonts-Not-Downloading-in-SXA-Theme/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">older</strong>
      <p class="article-nav-title">Custom Fonts Not Downloading in SXA Theme</p>
      <i class="icon" id="icon-chevron-left"></i>
    </a>
  
</nav>

  
  <div class="widgets-container">
    
  </div>
</aside>
        </div>
      </div>
    </div>
    <footer id="footer">
  
  <div class="container">
    <div class="container-inner">
      <a id="back-to-top" href="javascript:;"><i class="icon" id="icon-angle-up"></i></a>
      <div class="credit">
        <h1 class="logo-wrap">
          <a href="/" class="logo"></a>
        </h1>
        <p>&copy; 2020 Richard Seal</p>
        <p>Powered by <a href="//hexo.io/" target="_blank">Hexo</a>.
      </p></div>
    </div>
  </div>
</footer>
    
<script>
  var disqus_shortname = 'sitecorenutsbolts';
  
  var disqus_url = 'http://www.sitecorenutsbolts.net/2020/02/19/Sitecore-Docker-Making-Those-Urls-Pretty/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>



  <script src="http://code.jquery.com/jquery-2.1.3.min.js"></script>






<script src="/js/html-patch.js"></script>
<script src="/js/script.js"></script>
<script src="/js/readingTime.min.js"></script>

<script>
  $(function() {
    $('.article-entry').readingTime();
  });
</script>

  </div>
</body>
</html>
