<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>Setting up Solr on Habitat | Sitecore Nuts &amp; Bolts</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="The Sitecore Habitat project has got some great features in. One of my favourites is how the Gulp file is setup to make getting the project running on your local machine a breeze! It really does simpl">
<meta property="og:type" content="article">
<meta property="og:title" content="Setting up Solr on Habitat">
<meta property="og:url" content="http://www.sitecorenutsbolts.net/2016/06/28/Setting-up-Solr-on-Habitat/index.html">
<meta property="og:site_name" content="Sitecore Nuts &amp; Bolts">
<meta property="og:description" content="The Sitecore Habitat project has got some great features in. One of my favourites is how the Gulp file is setup to make getting the project running on your local machine a breeze! It really does simpl">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://www.sitecorenutsbolts.net/2016/06/28/Setting-up-Solr-on-Habitat/TaskRunnerExplorer.png">
<meta property="og:updated_time" content="2020-05-12T14:52:21.717Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Setting up Solr on Habitat">
<meta name="twitter:description" content="The Sitecore Habitat project has got some great features in. One of my favourites is how the Gulp file is setup to make getting the project running on your local machine a breeze! It really does simpl">
<meta name="twitter:image" content="http://www.sitecorenutsbolts.net/2016/06/28/Setting-up-Solr-on-Habitat/TaskRunnerExplorer.png">
  
  

  <link rel="stylesheet" href="/css/style.css">
  
  
  


  

<!--
  
    <link href='//fonts.useso.com/css?family=Titillium+Web:300,400,600' rel='stylesheet' type='text/css'>
    <link href="//fonts.useso.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
-->
</head>
</html>
<body>
  <div id="wrap">
    <header id="header">
  <div id="header-outer" class="outer">
    <div class="container">
      <div class="container-inner">
        <div id="header-title">
          <h1 class="logo-wrap">
            <a href="/" class="logo"></a>
          </h1>
          
            <h2 class="subtitle-wrap">
              <p class="subtitle">Design it, Code it, Build it. C# &amp; Sitecore!</p>
            </h2>
          
          
          <div class="mvp">
            <a href="http://www.sitecore.net/mvp" target="_blank">
              <img src="/about/index/MVP2016.jpg" alt="Sitecore MVP 2016-2020">
            </a>
            <a href="http://www.sitecore.net/mvp" target="_blank">
              <img src="/about/index/Technology2020.jpg" alt="Sitecore MVP 2016-2020">
            </a>
            <a href="http://www.sitecore.net/mvp" target="_blank">
              <img src="/about/index/Technology2019.jpg" alt="Sitecore MVP 2016-2020">
            </a>
            <a href="http://www.sitecore.net/mvp" target="_blank">
              <img src="/about/index/Technology2018.jpg" alt="Sitecore MVP 2016-2020">
            </a>
            <a href="http://www.sitecore.net/mvp" target="_blank">
                <img src="/about/index/Technology2017.jpg" alt="Sitecore MVP 2016-2020">
            </a>
            <a href="http://www.sitecore.net/mvp" target="_blank">
                <img src="/about/index/Technology2016.jpg" alt="Sitecore MVP 2016-2020">
            </a>
          </div>
          
        </div>
        <div id="header-inner" class="nav-container">
          <a id="main-nav-toggle" class="nav-icon"></a>
          <div class="nav-container-inner">
            <ul id="main-nav">
              
            </ul>
            <nav id="sub-nav">
              <div id="search-form-wrap">
                <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><input type="hidden" name="sitesearch" value="http://www.sitecorenutsbolts.net"></form>
              </div>
            </nav>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>
    <div class="container">
      <div class="main-body container-inner">
        <div class="main-body-inner">
          <section id="main">
            <div class="main-body-header">

              <h1 class="header"><a class="page-title-link" href="/categories/Sitecore/">Sitecore</a></h1>
            </div>
            <div class="main-body-content">
              
  <article id="post-Setting-up-Solr-on-Habitat" class="article article-single article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
      <!--  -->
      
        <header class="article-header">
          
  
    <h1 class="article-title" itemprop="name">
      Setting up Solr on Habitat
    </h1>
  

        </header>
      
      <p class="article-byline">
        <a href="/2016/06/28/Setting-up-Solr-on-Habitat/" class="article-date">
  <time datetime="2016-06-29T03:28:00.000Z" itemprop="datePublished">2016-06-28</time>
</a>
      </p>
      <div class="article-entry" itemprop="articleBody">
        <code>Estimated reading time:<span class="eta"></span></code>
        <p>The <a href="https://github.com/Sitecore/Habitat" target="_blank" rel="noopener">Sitecore Habitat</a> project has got some great features in. One of my favourites is how the <a href="http://gulpjs.com/" target="_blank" rel="noopener">Gulp</a> file is setup to make getting the project running on your local machine a breeze! It really does simplify the work a developer normally has to do when joining an existing project.</p>
<h3 id="Whats-Gulp-all-about-then"><a href="#Whats-Gulp-all-about-then" class="headerlink" title="Whats Gulp all about then?"></a>Whats Gulp all about then?</h3><p>For those that have never used Gulp before, Gulp is a <a href="https://nodejs.org/en/" target="_blank" rel="noopener">nodejs</a> based task runner. <a href="https://github.com/gulpjs/gulp/blob/master/docs/getting-started.md" target="_blank" rel="noopener">Getting started</a> with Gulp is pretty simple as you can see from that link. In Visual Studio 2015, there is some really nice support for task runners like Gulp, so now we don’t even need to leave the development environment.</p>
<p>In the Habitat project, Gulp is used for everything from setting up your Sitecore dependencies folder, transforming config files to publishing all the projects in the solution.</p>
<h3 id="How-does-SOLR-fit-in"><a href="#How-does-SOLR-fit-in" class="headerlink" title="How does SOLR fit in?"></a>How does SOLR fit in?</h3><p>There have been a number of blog posts already on how to set Solr up with a Sitecore 8 installation: </p>
<ul>
<li><a href="http://goblinrockets.com/2015/01/30/configuring-solr-search-sitecore-8/" target="_blank" rel="noopener">Configuring Solr search with Sitecore 8</a></li>
<li><a href="https://sitecore-community.github.io/docs/search/solr/Configuring-Solr-for-use-with-Sitecore-8/" target="_blank" rel="noopener">Configuring Solr for use with Sitecore 8</a></li>
</ul>
<p>etc…</p>
<p>One of the more annoying features is that you have to disable all the Lucene config files and enable all the Solr ones. At the last count this was nearly 20 files to enable, and another 20 to disable! In multiple folders too. </p>
<p>There are a few solutions out already that use scripts to set this up. But I wanted to be able to integrate this into the Habitat Gulp script so it becomes a one stop shop.</p>
<h3 id="Gulp-Rename"><a href="#Gulp-Rename" class="headerlink" title="Gulp-Rename"></a>Gulp-Rename</h3><p>The first option I looked at was <code>gulp-rename</code>. But because of the nature of task runners, doing the rename via a gulp pipe doesn’t work very well. A gulp pipe works in memory, nothing is committed to disk until the final <code>.pipe(gulp.dest(&quot;path&quot;));</code> call. So because the files are renamed in memory and then written to disk, it actually creates a copy of the files with the new name and leaves the existing ones alone…. Not helpful. This would require a separate task to then delete all the unwanted files, and that was also problematic.</p>
<h3 id="Exec-and-Powershell-to-the-rescue"><a href="#Exec-and-Powershell-to-the-rescue" class="headerlink" title="Exec and Powershell to the rescue!"></a>Exec and Powershell to the rescue!</h3><p>To setup a powershell script is pretty simple to do for this, and it turns out that executing a powershell script from Gulp is easy too.</p>
<p>The powershell script I’m using is a modified version of a gist by <a href="https://gist.github.com/patrickperrone" target="_blank" rel="noopener">Patrick Perron</a> that switches between <a href="https://gist.github.com/patrickperrone/59b8745ee8b8ff9045b5" target="_blank" rel="noopener">Lucene and Solr</a>.</p>
<p>The modified version, only switches from Lucene to Solr and expects the <code>$rootPath</code> to be passed into the function, rather than requesting input from the user.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">function Set-SCSearchProvider($rootPath)</span><br><span class="line">&#123;</span><br><span class="line">    $validInput = $true;</span><br><span class="line">    #test that path is valid</span><br><span class="line">    If (!(Test-Path -Path $rootPath))</span><br><span class="line">    &#123;</span><br><span class="line">        Write-Host &quot;The supplied path was invalid or inaccessible.&quot; -ForegroundColor Red;</span><br><span class="line">        $validInput = $false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    If ($validInput)</span><br><span class="line">    &#123;</span><br><span class="line">        Write-Host &quot;Set to Solr.&quot; -ForegroundColor Yellow;</span><br><span class="line">        $selectedProvider = &quot;Solr&quot;;</span><br><span class="line">        $deselectedProvider = &quot;Lucene&quot;;</span><br><span class="line"></span><br><span class="line">        #enumerate all config files to be enabled</span><br><span class="line">        $filter = &quot;*&quot; + $selectedProvider + &quot;*.config*&quot;;</span><br><span class="line">        $filesToEnable = Get-ChildItem -Recurse -File -Path $rootPath -Filter $filter;</span><br><span class="line">        foreach ($file in $filesToEnable)</span><br><span class="line">        &#123;</span><br><span class="line">            Write-Host $file.Name;</span><br><span class="line">            if (($file.Extension -ne &quot;.config&quot;))</span><br><span class="line">            &#123;</span><br><span class="line">                $newFileName = [io.path]::GetFileNameWithoutExtension($file.FullName);</span><br><span class="line">                $newFile = Rename-Item -Path $file.FullName -NewName $newFileName -PassThru;</span><br><span class="line">                Write-Host &quot;-&gt; &quot; $newFile.Name -ForegroundColor Green;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        #enumerate all config files to be disabled</span><br><span class="line">        $filter = &quot;*&quot; + $deselectedProvider + &quot;*.config*&quot;;</span><br><span class="line">        $filesToDisable = Get-ChildItem -Recurse -File -Path $rootPath -Filter $filter;</span><br><span class="line">        foreach ($file in $filesToDisable)</span><br><span class="line">        &#123;</span><br><span class="line">            Write-Host $file.Name;</span><br><span class="line">            if ($file.Extension -eq &quot;.config&quot;)</span><br><span class="line">            &#123;</span><br><span class="line">                $newFileName = $file.Name + &quot;.disabled&quot;;</span><br><span class="line">                $newFile = Rename-Item -Path $file.FullName -NewName $newFileName -PassThru;</span><br><span class="line">                Write-Host &quot;-&gt; &quot; $newFile.Name -ForegroundColor Green;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This is saved to the root of the solution to a file called <code>setup-solr.ps1</code></p>
<p>Now we can use a gulp task to execute that script:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gulp.task(<span class="string">"Setup-Solr-Config"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">    exec(<span class="string">"Powershell.exe -executionpolicy remotesigned . .\\setup-solr.ps1; Set-SCSearchProvider -rootPath '"</span> + config.websiteRoot + <span class="string">"'"</span>,</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params">err, stdout, stderr</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(stdout);</span><br><span class="line">            callback(err);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>To enable exec you need to require it like this:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> exec = <span class="built_in">require</span>(<span class="string">"child_process"</span>).exec;</span><br></pre></td></tr></table></figure></p>
<h3 id="Breaking-down-the-task"><a href="#Breaking-down-the-task" class="headerlink" title="Breaking down the task"></a>Breaking down the task</h3><p>The gulp task is pretty simple. We execute <code>Powershell.exe</code> and pass in the required parameters. Make sure the execution policy is set so that we can run our script and then give it the file with the function to import. Then we can just call the function and pass in the parameter for the <code>$rootPath</code>. With Habitat, this is stored in the <code>gulp-config.js</code> file, which creates a <code>config</code> object containing all required settings.</p>
<p><code>Exec</code> takes in 2 params, the command line to execute and a callback function to pass the output too. The callback function in this case, just logs the output from <code>stdout</code> to the console. Any errors are passed to the gulp task callback function.</p>
<p>Now the task appears in the task runner explorer and running it quickly renames all the required files to setup Habitat for Solr.</p>
<img src="/2016/06/28/Setting-up-Solr-on-Habitat/TaskRunnerExplorer.png" title="Task Runner Explorer">
<h3 id="Expanding-the-task"><a href="#Expanding-the-task" class="headerlink" title="Expanding the task"></a>Expanding the task</h3><p>We could make this even easier for developers. Some options to expand this task would include:</p>
<ul>
<li>Installing the binary files to the website instance from the Solr Support packge</li>
<li>Setting up a config patch file if you wanted to rename the Cores for developer machines that have multiple projects on the same Solr instance</li>
<li>Updating the Global.asax file to setup the IoC container with the right option for your project</li>
</ul>
<p>– Richard</p>

      </div>
      <footer class="article-footer">
        <a data-url="http://www.sitecorenutsbolts.net/2016/06/28/Setting-up-Solr-on-Habitat/" data-id="cka5tzg9f003ggsvrwbdfhav8" class="article-share-link">Share</a>
        
          <a href="http://www.sitecorenutsbolts.net/2016/06/28/Setting-up-Solr-on-Habitat/#comments" class="article-comment-link">Comments</a>
        
        
      </footer>
    </div>
  </article>
  
    <section id="comments">
      <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      </div>
    </section>
  


<!-- Go to www.addthis.com/dashboard to customize your tools -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-55d6161f325b85fa" async="async"></script>
            </div>
          </section>
          <aside id="sidebar">
  <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
  <div class="sidebar-top">
    <p>follow:</p>
    <ul class="social-links">
      
    </ul>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/07/23/Sitecore-and-React-It-IS-that-easy/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">newer</strong>
      <p class="article-nav-title">
        
          Sitecore and React - It IS that easy!
        
      </p>
      <i class="icon" id="icon-chevron-right"></i>
    </a>
  
  
    <a href="/2016/06/02/Watch-your-Guid-format/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">older</strong>
      <p class="article-nav-title">Watch your Guid format!</p>
      <i class="icon" id="icon-chevron-left"></i>
    </a>
  
</nav>

  
  <div class="widgets-container">
    
  </div>
</aside>
        </div>
      </div>
    </div>
    <footer id="footer">
  
  <div class="container">
    <div class="container-inner">
      <a id="back-to-top" href="javascript:;"><i class="icon" id="icon-angle-up"></i></a>
      <div class="credit">
        <h1 class="logo-wrap">
          <a href="/" class="logo"></a>
        </h1>
        <p>&copy; 2020 Richard Seal</p>
        <p>Powered by <a href="//hexo.io/" target="_blank">Hexo</a>.
      </p></div>
    </div>
  </div>
</footer>
    
<script>
  var disqus_shortname = 'sitecorenutsbolts';
  
  var disqus_url = 'http://www.sitecorenutsbolts.net/2016/06/28/Setting-up-Solr-on-Habitat/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>



  <script src="http://code.jquery.com/jquery-2.1.3.min.js"></script>






<script src="/js/html-patch.js"></script>
<script src="/js/script.js"></script>
<script src="/js/readingTime.min.js"></script>

<script>
  $(function() {
    $('.article-entry').readingTime();
  });
</script>

  </div>
</body>
</html>
